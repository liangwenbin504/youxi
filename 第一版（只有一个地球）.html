<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã€Šåªæœ‰ä¸€ä¸ªåœ°çƒã€‹ç»ƒä¹ é¢˜ï¼ˆå­¦ç”Ÿç‰ˆï¼‰</title>
  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    /* å…¨å±€æ ·å¼ */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Microsoft YaHei", sans-serif; background: #f5f7fa; padding-top: 20px; padding-bottom: 50px; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); padding: 24px; margin-bottom: 24px; transition: box-shadow 0.3s; }
    .card:hover { box-shadow: 0 6px 16px rgba(0,0,0,0.12); }
    
    /* æŒ‰é’®æ ·å¼ */
    .btn { padding: 12px 24px; border-radius: 8px; cursor: pointer; border: none; font-size: 16px; font-weight: 500; transition: all 0.3s; }
    .btn-primary { background: #1a73e8; color: white; }
    .btn-primary:hover { background: #0d62d0; transform: translateY(-2px); }
    .btn-primary:active { transform: translateY(0); }
    .btn-secondary { background: #f1f3f4; color: #202124; }
    .btn-secondary:hover { background: #e8eaed; }
    
    /* è¿›åº¦æ¡æ ·å¼ */
    .progress-bar { height: 6px; background: #e8eaed; border-radius: 3px; margin: 15px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: #1a73e8; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    
    /* é€‰é¡¹æ ·å¼ */
    .option { border: 1px solid #dadce0; padding: 14px 16px; border-radius: 8px; margin-bottom: 12px; cursor: pointer; transition: all 0.3s; background: #fff; }
    .option:hover { border-color: #1a73e8; background: #f8fafc; }
    .option.selected { border-color: #1a73e8; background: #e8f0fe; box-shadow: 0 2px 4px rgba(26, 115, 232, 0.1); }
    
    /* åé¦ˆæ ·å¼ */
    .feedback { padding: 14px 16px; border-radius: 8px; margin: 12px 0; font-size: 16px; }
    .feedback.correct { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #2e7d32; }
    .feedback.wrong { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; }
    
    /* å·¥å…·ç±» */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .flex { display: flex; }
    .justify-between { justify-content: space-between; }
    .items-center { align-items: center; }
    .flex-col { flex-direction: column; }
    .gap-4 { gap: 16px; }
    .gap-6 { gap: 24px; }
    .py-10 { padding: 48px 0; }
    .py-8 { padding: 32px 0; }
    .text-2xl { font-size: 28px; }
    .text-xl { font-size: 22px; }
    
    /* è¿”å›æŒ‰é’®æ ·å¼ */
    .back-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(0, 123, 255, 0.9);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        z-index: 1000;
        display: none;
    }
    
    .back-button:hover {
        background-color: rgba(0, 86, 179, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    
    .back-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    .text-lg { font-size: 18px; }
    .text-sm { font-size: 14px; }
    .font-bold { font-weight: 700; }
    .font-medium { font-weight: 500; }
    .mb-6 { margin-bottom: 24px; }
    .mb-8 { margin-bottom: 32px; }
    .mb-4 { margin-bottom: 16px; }
    .mt-6 { margin-top: 24px; }
    .mt-4 { margin-top: 16px; }
    .mt-2 { margin-top: 8px; }
    .ml-3 { margin-left: 12px; }
    .text-gray-600 { color: #4b5563; }
    .text-gray-500 { color: #6b7280; }
    .text-primary { color: #1a73e8; }
    
    /* è¡¨å•æ ·å¼ */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
    .form-control { width: 100%; padding: 12px 16px; border: 1px solid #dadce0; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
    .form-control:focus { outline: none; border-color: #1a73e8; box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2); }
    
    /* å…³å¡å¡ç‰‡æ ·å¼ */
    .level-card { cursor: pointer; transition: all 0.3s; }
    .level-card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0,0,0,0.08); }
    .level-card.opacity-50 { opacity: 0.5; cursor: not-allowed; }
    
    /* å…¶ä»–æ ·å¼ */
    .maker { font-size: 16px; color: #6b7280; margin-top: 8px; font-style: italic; }
    
    /* å¥–åŠ±å¼¹çª— */
    .reward-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 999; }
    .reward-content { background: white; padding: 40px 60px; border-radius: 16px; text-align: center; animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .reward-text { font-size: 48px; font-weight: bold; margin-bottom: 20px; line-height: 1.2; }
    .reward-desc { font-size: 18px; color: #4b5563; margin-bottom: 30px; }
    .reward-emoji { font-size: 64px; margin-bottom: 16px; }
    
    @keyframes popIn {
      0% { transform: scale(0.6); opacity: 0; }
      80% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* åŒ¹é…é¢˜æ ·å¼ */
    .match-container { display: flex; flex-direction: column; gap: 16px; }
    .match-row { display: flex; gap: 24px; }
    .match-column { flex: 1; }
    .match-label { font-size: 18px; font-weight: 500; margin-bottom: 12px; color: #1a73e8; }
    .match-item { padding: 12px; border: 1px solid #dadce0; border-radius: 6px; margin-bottom: 8px; cursor: move; background: white; }
    .match-item.dragging { opacity: 0.7; background: #f1f3f4; }
    .match-target { min-height: 46px; border: 1px dashed #dadce0; border-radius: 6px; margin-bottom: 8px; padding: 12px; }
    .match-target.filled { border-style: solid; border-color: #1a73e8; background: #e8f0fe; }
    
    /* é¢˜ç›®æ ‡ç­¾ */
    .question-tag { display: inline-block; padding: 4px 8px; background: #1a73e8; color: white; border-radius: 4px; font-size: 14px; margin-right: 8px; }
    
    /* å§“åé€‰æ‹©é¡µ */
    .name-select-page { text-align: center; padding: 40px 20px; }
    .upload-area { border: 2px dashed #dadce0; border-radius: 12px; padding: 30px; margin-bottom: 30px; transition: border-color 0.3s; }
    .upload-area:hover { border-color: #1a73e8; }
    .upload-icon { font-size: 48px; color: #6b7280; margin-bottom: 16px; }
    .upload-loading { color: #1a73e8; font-size: 16px; margin-top: 10px; }
    
    /* ç½‘æ ¼å¸ƒå±€ */
    .grid { display: grid; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .md\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

    @media (max-width: 768px) {
      .grid-cols-2 { grid-template-columns: 1fr; }
      .match-row { flex-direction: column; gap: 16px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 1. å§“åé€‰æ‹©é¡µé¢ -->
    <div id="name-select-page" class="name-select-page card">
      <h1 class="text-2xl font-bold mb-2">ã€Šåªæœ‰ä¸€ä¸ªåœ°çƒã€‹ç»ƒä¹ é¢˜</h1>
      <p class="maker">ã€åˆ¶ä½œè€…ï¼šæ¢æ–‡å½¬ã€‘</p>
      <p class="text-gray-600 mt-6 mb-8">è¯·å…ˆä¸Šä¼ å§“ååå•å¹¶é€‰æ‹©ä½ çš„å§“å</p>

      <!-- Excelä¸Šä¼ åŒºåŸŸ -->
      <div class="upload-area mb-6">
        <div class="upload-icon">ğŸ“Š</div>
        <p class="mb-4">ç‚¹å‡»ä¸Šä¼ å§“ååå•ï¼ˆmingdan.xlsxï¼‰</p>
        <!-- æ¯æ¬¡ç‚¹å‡»é‡æ–°åˆ›å»ºfile inputï¼Œé¿å…ç¼“å­˜æ—§æ–‡ä»¶ -->
        <div id="file-input-container">
          <input type="file" id="excel-upload" accept=".xlsx, .xls" class="hidden">
        </div>
        <button id="upload-btn" class="btn btn-primary">é€‰æ‹©Excelæ–‡ä»¶</button>
        <p id="upload-loading" class="upload-loading hidden">è§£æä¸­...è¯·ç¨å€™</p>
        <p id="upload-tip" class="text-sm text-gray-500 mt-4 hidden">å·²ä¸Šä¼ ï¼š<span id="file-name"></span></p>
        <button id="reupload-btn" class="btn btn-secondary mt-4 hidden">é‡æ–°é€‰æ‹©æ–‡ä»¶</button>
      </div>

      <!-- å§“åé€‰æ‹©ä¸‹æ‹‰æ¡† -->
      <div class="form-group hidden" id="name-select-group">
        <label class="form-label">é€‰æ‹©ä½ çš„å§“å</label>
        <select id="student-name" class="form-control">
          <option value="">-- è¯·é€‰æ‹©å§“å --</option>
        </select>
      </div>

      <!-- å¼€å§‹æ¸¸æˆæŒ‰é’® -->
      <button id="enter-game" class="btn btn-primary mt-6 hidden">è¿›å…¥æ¸¸æˆ</button>
    </div>

    <!-- 2. åˆå§‹é¡µé¢ -->
    <div id="intro" class="card text-center py-10 hidden">
      <h1 class="text-2xl font-bold mb-2">ã€Šåªæœ‰ä¸€ä¸ªåœ°çƒã€‹ç»ƒä¹ é¢˜</h1>
      <p class="maker">ã€åˆ¶ä½œè€…ï¼šæ¢æ–‡å½¬ã€‘</p>
      <p class="text-gray-600 mt-2">å½“å‰ç­”é¢˜å­¦ç”Ÿï¼š<span id="current-student" class="text-primary font-bold"></span></p>
      <p class="mb-8 text-gray-600 mt-6">å…±22é¢˜ï¼Œåˆ†4ä¸ªå…³å¡ï¼Œè¦†ç›–è¯¾æ–‡å­—è¯ã€ç†è§£ã€ä¸»æ—¨ã€æ‹“å±•å…¨è€ƒç‚¹ï¼</p>
      <button id="start" class="btn btn-primary text-lg px-8">å¼€å§‹ç»ƒä¹ </button>
      <button id="download-html" class="btn btn-secondary text-lg px-8 mt-4">ä¸‹è½½HTMLæ–‡ä»¶ï¼ˆä¿å­˜åˆ°E:\youxiï¼‰</button>
    </div>

    <!-- 3. å…³å¡å¯¼èˆª -->
    <div id="levels" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4 my-6">
      <div class="level-card card text-center" data-level="0">
        <div class="font-bold text-lg">å­—è¯ç§¯ç´¯</div>
        <div class="text-sm text-gray-500 mt-2">6é¢˜</div>
      </div>
      <div class="level-card card text-center opacity-50" data-level="1">
        <div class="font-bold text-lg">å†…å®¹ç†è§£</div>
        <div class="text-sm text-gray-500 mt-2">5é¢˜</div>
      </div>
      <div class="level-card card text-center opacity-50" data-level="2">
        <div class="font-bold text-lg">ä¸»æ—¨æ€è¾¨</div>
        <div class="text-sm text-gray-500 mt-2">5é¢˜</div>
      </div>
      <div class="level-card card text-center opacity-50" data-level="3">
        <div class="font-bold text-lg">æ‹“å±•åº”ç”¨</div>
        <div class="text-sm text-gray-500 mt-2">6é¢˜</div>
      </div>
    </div>

    <!-- 4. ç»ƒä¹ åŒºåŸŸ -->
    <div id="exercise" class="hidden">
      <div class="card">
        <div class="flex justify-between items-center mb-6">
          <h2 id="level-title" class="font-bold text-xl"></h2>
          <div class="flex items-center gap-4">
            <span id="question-count" class="text-gray-500">1/6</span>
            <span class="text-gray-500">å½“å‰å­¦ç”Ÿï¼š<span id="exercise-student" class="text-primary font-medium"></span></span>
          </div>
        </div>
        <div class="progress-bar">
          <div id="level-progress" class="progress-fill" style="width: 0%"></div>
        </div>
        <div id="question" class="mt-8 text-lg font-medium"></div>
        <div id="options" class="space-y-4 mt-6"></div>
        <div id="feedback" class="feedback hidden mt-6"></div>
      </div>
      <div class="flex flex-wrap justify-between items-center mt-6 gap-4">
        <button id="prev" class="btn btn-primary hidden">ä¸Šä¸€é¢˜</button>
        <div class="flex gap-3">
          <button id="submit" class="btn btn-primary">æäº¤ç­”æ¡ˆ</button>
          <button id="next" class="btn btn-primary hidden">ä¸‹ä¸€é¢˜</button>
          <button id="complete" class="btn btn-primary hidden">å®Œæˆå…³å¡</button>
        </div>
      </div>
    </div>

    <!-- 5. å®Œæˆé¡µé¢ -->
    <div id="result" class="hidden card text-center py-8">
      <h2 class="text-2xl font-bold mb-4">ç»ƒä¹ å®Œæˆï¼</h2>
      <p class="text-lg mb-2">å½“å‰å­¦ç”Ÿï¼š<span id="result-student" class="text-primary font-bold"></span></p>
      <p class="text-lg mb-2">æ€»å¾—åˆ†: <span id="final-score" class="text-primary font-bold">0</span>/22</p>
      <p class="text-gray-500 mb-6">å‰©ä½™ç”Ÿå‘½å€¼: <span id="final-health" class="font-bold">10</span></p>
      <button id="export-score" class="btn btn-primary text-lg px-8 mb-4">å¯¼å‡ºå¾—åˆ†è®°å½•ï¼ˆä¿å­˜åˆ°E:\youxiï¼‰</button>
      <button id="restart" class="btn btn-primary text-lg px-8">é‡æ–°å¼€å§‹</button>
    </div>

    <!-- 6. å¥–åŠ±å¼¹çª— -->
    <div id="reward-modal" class="reward-modal hidden">
      <div class="reward-content">
        <div class="reward-emoji" id="reward-emoji">ğŸŒ¸</div>
        <div class="reward-text" id="reward-text">é€ä½ èŠ±èŠ±ï¼</div>
        <div class="reward-desc" id="reward-desc">ç”Ÿå‘½å€¼æ»¡åˆ†ï¼ç¯ä¿å°å«å£«å®è‡³åå½’ï½</div>
        <button id="close-reward" class="btn btn-primary">ç»§ç»­</button>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€çŠ¶æ€ç®¡ç†
    const state = {
      level: 0,
      question: 0,
      score: 0,
      health: 10,
      completed: [false, false, false, false],
      studentName: "", // å½“å‰ç­”é¢˜å­¦ç”Ÿå§“å
      nameList: [], // ä»Excelè¯»å–çš„å§“ååˆ—è¡¨
      scoreRecords: [], // å¾—åˆ†è®°å½•ï¼š[{questionNo, questionContent, isCorrect, score, time}]
      isParsing: false, // æ ‡è®°æ˜¯å¦æ­£åœ¨è§£æï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
      userAnswers: {} // å­˜å‚¨ç”¨æˆ·ç­”æ¡ˆï¼š{level: {question: answer}}
    };

    // DOMå…ƒç´ ç¼“å­˜
    const el = {
      // å§“åé€‰æ‹©é¡µé¢
      nameSelectPage: document.getElementById('name-select-page'),
      fileInputContainer: document.getElementById('file-input-container'),
      excelUpload: document.getElementById('excel-upload'),
      uploadBtn: document.getElementById('upload-btn'),
      uploadLoading: document.getElementById('upload-loading'),
      uploadTip: document.getElementById('upload-tip'),
      fileName: document.getElementById('file-name'),
      reuploadBtn: document.getElementById('reupload-btn'),
      nameSelectGroup: document.getElementById('name-select-group'),
      studentName: document.getElementById('student-name'),
      enterGame: document.getElementById('enter-game'),
      // å…¶ä»–é¡µé¢å…ƒç´ 
      intro: document.getElementById('intro'),
      currentStudent: document.getElementById('current-student'),
      start: document.getElementById('start'),
      downloadHtml: document.getElementById('download-html'),
      levels: document.getElementById('levels'),
      exercise: document.getElementById('exercise'),
      levelTitle: document.getElementById('level-title'),
      question: document.getElementById('question'),
      options: document.getElementById('options'),
      feedback: document.getElementById('feedback'),
      questionCount: document.getElementById('question-count'),
      prev: document.getElementById('prev'),
      submit: document.getElementById('submit'),
      next: document.getElementById('next'),
      complete: document.getElementById('complete'),
      exerciseStudent: document.getElementById('exercise-student'),
      result: document.getElementById('result'),
      finalScore: document.getElementById('final-score'),
      finalHealth: document.getElementById('final-health'),
      resultStudent: document.getElementById('result-student'),
      exportScore: document.getElementById('export-score'),
      restart: document.getElementById('restart'),
      levelProgress: document.getElementById('level-progress'),
      rewardModal: document.getElementById('reward-modal'),
      rewardEmoji: document.getElementById('reward-emoji'),
      rewardText: document.getElementById('reward-text'),
      rewardDesc: document.getElementById('reward-desc'),
      closeReward: document.getElementById('close-reward')
    };

    // ç»ƒä¹ é¢˜æ•°æ®
    const data = {
      levels: [
        {
          title: "å­—è¯ç§¯ç´¯",
          questions: [
            {type: "choice", q: "<span class='question-tag'>1</span>ä¸‹åˆ—è¯è¯­ä¸­åŠ ç‚¹å­—çš„è¯»éŸ³å®Œå…¨ç›¸åŒçš„æ˜¯å“ªä¸€é¡¹ï¼Ÿ", o: ["è–„å¼±ï¼ˆbÃ³ï¼‰ è–„è„†ï¼ˆbÃ¡oï¼‰", "æä¾›ï¼ˆgÅngï¼‰ ä¾›å“ï¼ˆgÃ²ngï¼‰", "ç³»åˆ—ï¼ˆxÃ¬ï¼‰ ç³»é‹å¸¦ï¼ˆjÃ¬ï¼‰", "ç¾éš¾ï¼ˆnÃ nï¼‰ è´£éš¾ï¼ˆnÃ nï¼‰"], a: 3, explanation: "Aé¡¹â€œè–„å¼±â€è¯»bÃ³ï¼Œâ€œè–„è„†â€è¯»bÃ¡oï¼›Bé¡¹â€œæä¾›â€è¯»gÅngï¼Œâ€œä¾›å“â€è¯»gÃ²ngï¼›Cé¡¹â€œç³»åˆ—â€è¯»xÃ¬ï¼Œâ€œç³»é‹å¸¦â€è¯»jÃ¬ï¼›Dé¡¹â€œç¾éš¾â€â€œè´£éš¾â€å‡è¯»nÃ nï¼Œè¯»éŸ³å®Œå…¨ç›¸åŒã€‚"},
            {type: "choice", q: "<span class='question-tag'>2</span>æ ¹æ®æ‹¼éŸ³å¡«å†™è¯è¯­ï¼Œå…¨éƒ¨æ­£ç¡®çš„ä¸€é¡¹æ˜¯ï¼ˆ ï¼‰ï¼š<br>jÄ«ng yÃ­ng ç¾ä¸½çš„åœ°çƒæ˜¯ç”Ÿå‘½çš„ yÃ¡o lÃ¡n...", o: ["æ™¶è¹ æ‘‡è“ å’Œè”¼...", "æ™¶è¥ æ‘‡ç¯® å’Œè”¼...", "æ™¶è¹ æ‘‡ç¯® å’Œè”¼...", "æ™¶è¹ æ‘‡ç¯® åˆè”¼..."], a: 2, explanation: "æ­£ç¡®å­—å½¢ä¸ºâ€œæ™¶è¹ã€æ‘‡ç¯®ã€å’Œè”¼ã€æ…·æ…¨ã€èµ„æºã€æ»¥ã€èŠ‚åˆ¶ã€ç”Ÿæ€â€ï¼›Aé¡¹â€œæ‘‡è“â€é”™è¯¯ï¼ŒBé¡¹â€œæ™¶è¥â€â€œæ…·æ¦‚â€â€œçƒ‚â€é”™è¯¯ï¼ŒDé¡¹â€œåˆè”¼â€â€œèµ„åŸâ€â€œèŠ‚æ²»â€é”™è¯¯ã€‚"},
            {type: "choice", q: "<span class='question-tag'>3</span>ä¸â€œæ…·æ…¨â€æ„æ€æœ€ç›¸è¿‘çš„è¯è¯­æ˜¯ï¼ˆ ï¼‰", o: ["åå•¬", "å¤§æ–¹", "èŠ‚çº¦", "å°æ°”"], a: 1, explanation: "â€œæ…·æ…¨â€æŒ‡å¾…äººå®½åšã€ä¸åå•¬ï¼Œæ–‡ä¸­æŒ‡åœ°çƒæ— ç§æä¾›èµ„æºï¼Œä¸â€œå¤§æ–¹â€æ„æ€ç›¸è¿‘ï¼›â€œåå•¬â€â€œå°æ°”â€æ˜¯åä¹‰è¯ï¼Œâ€œèŠ‚çº¦â€æŒ‡èŠ‚çœï¼Œä¸â€œæ…·æ…¨â€æ— å…³ã€‚"},
            {type: "choice", q: "<span class='question-tag'>4</span>â€œäººä»¬ä¸é¡¾åæœåœ°æ»¥ç”¨åŒ–å­¦å“â€ä¸­â€œé¡¾â€çš„æ„æ€æ˜¯ï¼ˆ ï¼‰", o: ["æ‹œè®¿", "ç…§é¡¾", "è€ƒè™‘ã€é¡¾åŠ", "çœ‹"], a: 2, explanation: "â€œä¸é¡¾åæœâ€æŒ‡ä¸è€ƒè™‘è¡Œä¸ºå¸¦æ¥çš„ç»“æœï¼Œâ€œé¡¾â€æ­¤å¤„æ„ä¸ºâ€œè€ƒè™‘ã€é¡¾åŠâ€ï¼›å…¶ä»–é€‰é¡¹â€œæ‹œè®¿â€â€œç…§é¡¾â€â€œçœ‹â€å‡ä¸ç¬¦åˆè¯­å¢ƒã€‚"},
            {type: "choice", q: "<span class='question-tag'>5</span>ä¸‹åˆ—è¯è¯­ä¸­ï¼Œä¸â€œç”Ÿæ€ç¾éš¾â€æ„Ÿæƒ…è‰²å½©ç›¸åŒçš„æ˜¯ï¼ˆ ï¼‰", o: ["æ™¶è¹å‰”é€", "æ…·æ…¨ç»™äºˆ", "ä¹±ç æ»¥ä¼", "å’Œè”¼å¯äº²"], a: 2, explanation: "â€œç”Ÿæ€ç¾éš¾â€æ˜¯è´¬ä¹‰è¯ï¼ŒæŒ‡ç ´åç¯å¢ƒå¸¦æ¥çš„ç¾å®³ï¼›â€œä¹±ç æ»¥ä¼â€ä¹Ÿæ˜¯è´¬ä¹‰è¯ï¼ŒæŒ‡æ— èŠ‚åˆ¶ç ä¼æ ‘æœ¨ï¼›å…¶ä»–é€‰é¡¹å‡ä¸ºè¤’ä¹‰è¯ã€‚"},
            {type: "choice", q: "<span class='question-tag'>6</span>ä¸‹åˆ—è¯è¯­ä¸­ï¼Œå­—å½¢å…¨éƒ¨æ­£ç¡®çš„æ˜¯ï¼ˆ ï¼‰", o: ["æ‘‡è“ æ¯ç«­ ç’€ç’¨", "æ»¥ç”¨ èŠ‚åˆ¶ æ™¶è¹", "å’Œéœ­ èµ„æº æ…·æ…¨", "ç”Ÿå¤ª æ‘‡ç¯® å’Œè”¼"], a: 1, explanation: "Aé¡¹â€œæ‘‡è“â€åº”ä¸ºâ€œæ‘‡ç¯®â€ï¼ŒCé¡¹â€œå’Œéœ­â€åº”ä¸ºâ€œå’Œè”¼â€ï¼ŒDé¡¹â€œç”Ÿå¤ªâ€åº”ä¸ºâ€œç”Ÿæ€â€ï¼›Bé¡¹å­—å½¢å…¨éƒ¨æ­£ç¡®ã€‚"}
          ]
        },
        {
          title: "å†…å®¹ç†è§£",
          questions: [
            {type: "choice", q: "<span class='question-tag'>7</span>â€œåœ°çƒæ˜¯ä¸€ä¸ªåŠå¾„çº¦ä¸º6400åƒç±³çš„æ˜Ÿçƒâ€è¿ç”¨çš„è¯´æ˜æ–¹æ³•æ˜¯ï¼ˆ ï¼‰", o: ["ä¸¾ä¾‹å­", "åˆ—æ•°å­—", "ä½œæ¯”è¾ƒ", "æ‰“æ¯”æ–¹"], a: 1, explanation: "å¥å­é€šè¿‡å…·ä½“æ•°å­—â€œ6400åƒç±³â€å‡†ç¡®è¯´æ˜åœ°çƒçš„å¤§å°ï¼Œè¿ç”¨â€œåˆ—æ•°å­—â€çš„è¯´æ˜æ–¹æ³•ï¼Œè®©è¡¨è¿°æ›´ç§‘å­¦ã€æœ‰è¯´æœåŠ›ã€‚"},
            {type: "choice", q: "<span class='question-tag'>8</span>ä¸‹åˆ—å…³äºåœ°çƒè‡ªç„¶èµ„æºçš„è¯´æ³•ï¼Œä¸ç¬¦åˆè¯¾æ–‡å†…å®¹çš„æ˜¯ï¼ˆ ï¼‰", o: ["çŸ¿äº§èµ„æºæ˜¯ç»è¿‡å‡ ç™¾ä¸‡å¹´ç”šè‡³å‡ äº¿å¹´çš„åœ°è´¨å˜åŒ–å½¢æˆçš„", "æ°´èµ„æºã€åœŸåœ°èµ„æºã€ç”Ÿç‰©èµ„æºæœ¬æ¥å¯ä»¥ä¸æ–­å†ç”Ÿ...", "äººä»¬éšæ„æ¯åè‡ªç„¶èµ„æºã€æ»¥ç”¨åŒ–å­¦å“ï¼Œä¼šå¯¼è‡´èµ„æºæ— æ³•å†ç”Ÿ", "åœ°çƒçš„è‡ªç„¶èµ„æºååˆ†ä¸°å¯Œï¼Œå³ä½¿æ— èŠ‚åˆ¶å¼€é‡‡ä¹Ÿä¸ä¼šæ¯ç«­"], a: 3, explanation: "è¯¾æ–‡æ˜ç¡®æŒ‡å‡ºâ€œåœ°çƒæ‰€æ‹¥æœ‰çš„è‡ªç„¶èµ„æºä¹Ÿæ˜¯æœ‰é™çš„â€ï¼Œæ— èŠ‚åˆ¶å¼€é‡‡ä¼šåŠ é€Ÿèµ„æºæ¯ç«­ï¼›å…¶ä»–é€‰é¡¹å‡ä¸è¯¾æ–‡å†…å®¹ä¸€è‡´ã€‚"},
            {type: "choice", q: "<span class='question-tag'>9</span>â€œåœ°çƒï¼Œè¿™ä½äººç±»çš„æ¯äº²ï¼Œè¿™ä¸ªç”Ÿå‘½çš„æ‘‡ç¯®â€è¿™å¥è¯çš„è¡¨è¾¾æ•ˆæœæ˜¯ï¼ˆ ï¼‰", o: ["è¯´æ˜åœ°çƒçš„å½¢çŠ¶åƒæ¯äº²å’Œæ‘‡ç¯®", "è¿ç”¨æ¯”å–»ï¼Œç”ŸåŠ¨çªå‡ºåœ°çƒå­•è‚²ç”Ÿå‘½çš„é‡è¦ä½œç”¨", "ä»‹ç»åœ°çƒçš„ä½ç½®åœ¨å®‡å®™ä¸­çš„â€œæ¯äº²â€åœ°ä½", "è¡¨è¾¾å¯¹æ¯äº²çš„æ€å¿µå’Œå¯¹æ‘‡ç¯®çš„å›å¿†"], a: 1, explanation: "è¿™å¥è¯å°†åœ°çƒæ¯”ä½œâ€œäººç±»çš„æ¯äº²â€â€œç”Ÿå‘½çš„æ‘‡ç¯®â€ï¼Œè¿ç”¨æ¯”å–»çš„è¯´æ˜æ–¹æ³•ï¼Œå½¢è±¡åœ°å¼ºè°ƒåœ°çƒæ˜¯äººç±»å’Œæ‰€æœ‰ç”Ÿå‘½çš„å­•è‚²è€…ï¼Œçªå‡ºå…¶é‡è¦æ€§ã€‚"},
            {type: "choice", q: "<span class='question-tag'>10</span>â€œç§‘å­¦å®¶å·²ç»è¯æ˜ï¼Œè‡³å°‘åœ¨ä»¥åœ°çƒä¸ºä¸­å¿ƒçš„40ä¸‡äº¿åƒç±³çš„èŒƒå›´å†…...â€ä¸­â€œè‡³å°‘â€çš„ä½œç”¨æ˜¯ï¼ˆ ï¼‰", o: ["ä½“ç°è¯­è¨€çš„éšæ„æ€§...", "ä½“ç°è¯­è¨€çš„ä¸¥è°¨æ€§...", "ä½“ç°è¯­è¨€çš„å¤¸å¼ æ€§...", "ä½“ç°è¯­è¨€çš„ç®€æ´æ€§..."], a: 1, explanation: "â€œè‡³å°‘â€è¡¨ç¤ºâ€œæœ€å°é™åº¦â€ï¼Œè¯´æ˜ç›®å‰ç§‘å­¦å®¶ä»…èƒ½è¯æ˜â€œ40ä¸‡äº¿åƒç±³èŒƒå›´å†…â€æ— å®œå±…æ˜Ÿçƒï¼Œä¸æ’é™¤æ›´è¿œèŒƒå›´çš„å¯èƒ½æ€§ï¼Œä½“ç°è¯´æ˜æ–‡è¯­è¨€çš„å‡†ç¡®æ€§å’Œä¸¥è°¨æ€§ã€‚"},
            {type: "choice", q: "<span class='question-tag'>11</span>ä¸‹åˆ—è‡ªç„¶èµ„æºä¸­ï¼Œä¸å±äºâ€œæœ¬æ¥å¯ä»¥ä¸æ–­å†ç”Ÿâ€çš„æ˜¯ï¼ˆ ï¼‰", o: ["æ£®æ—èµ„æº", "ç…¤ç‚­èµ„æº", "æ°´èµ„æº", "ç”Ÿç‰©èµ„æº"], a: 1, explanation: "ç…¤ç‚­èµ„æºæ˜¯ç»è¿‡æ¼«é•¿åœ°è´¨å¹´ä»£å½¢æˆçš„ä¸å¯å†ç”Ÿèµ„æºï¼Œæ¶ˆè€—åæ— æ³•çŸ­æœŸå†…å†ç”Ÿï¼›æ£®æ—ã€æ°´ã€ç”Ÿç‰©èµ„æºåœ¨åˆç†åˆ©ç”¨ä¸‹å¯ä¸æ–­å†ç”Ÿï¼Œå±äºå¯å†ç”Ÿèµ„æºã€‚"}
          ]
        },
        {
          title: "ä¸»æ—¨æ€è¾¨",
          questions: [
            {type: "choice", q: "<span class='question-tag'>12</span>ä½œè€…å¾—å‡ºâ€œæˆ‘ä»¬è¦ç²¾å¿ƒåœ°ä¿æŠ¤åœ°çƒ...â€è¿™ä¸€ç»“è®ºçš„ä¾æ®ä¸åŒ…æ‹¬ï¼ˆ ï¼‰", o: ["åœ°çƒç¾ä¸½å£®è§‚ä½†åœ¨å®‡å®™ä¸­ååˆ†æ¸ºå°", "åœ°çƒèµ„æºæœ‰é™ä¸”æ˜“è¢«äººç±»ç ´å", "äººç±»ç›®å‰æ— æ³•ç§»å±…åˆ°å…¶ä»–æ˜Ÿçƒ", "åœ°çƒæ˜¯å¤ªé˜³ç³»ä¸­ä½“ç§¯æœ€å¤§çš„è¡Œæ˜Ÿ"], a: 3, explanation: "è¯¾æ–‡ä¸­ä½œè€…çš„è®ºè¯ä¾æ®åŒ…æ‹¬â€œåœ°çƒæ¸ºå°ã€èµ„æºæœ‰é™ã€æ— æ³•ç§»å±…â€ï¼Œè€Œâ€œåœ°çƒæ˜¯å¤ªé˜³ç³»æœ€å¤§è¡Œæ˜Ÿâ€ä¸äº‹å®ä¸ç¬¦ï¼ˆå¤ªé˜³ç³»æœ€å¤§è¡Œæ˜Ÿæ˜¯æœ¨æ˜Ÿï¼‰ï¼Œä¹Ÿä¸æ˜¯ä½œè€…çš„è®ºè¯ä¾æ®ã€‚"},
            {type: "choice", q: "<span class='question-tag'>13</span>â€œæˆ‘ä»¬è¿™ä¸ªåœ°çƒå¤ªå¯çˆ±äº†ï¼ŒåŒæ—¶åˆå¤ªå®¹æ˜“ç ´ç¢äº†â€ä¸­â€œå¯çˆ±â€å’Œâ€œå®¹æ˜“ç ´ç¢â€åˆ†åˆ«æŒ‡ï¼ˆ ï¼‰", o: ["åœ°çƒå¤–è¡¨ç¾ä¸½ / åœ°çƒè´¨åœ°è„†å¼±...", "åœ°çƒå­•è‚²ç”Ÿå‘½ã€æ™¯è‰²ä¼˜ç¾ / åœ°çƒç”Ÿæ€ç¯å¢ƒæ˜“è¢«äººç±»ç ´å", "åœ°çƒåœ¨å®‡å®™ä¸­å¾ˆæ˜¾çœ¼ / åœ°çƒå®¹æ˜“è¢«å°è¡Œæ˜Ÿæ’å‡»", "åœ°çƒæ°”å€™é€‚å®œ / åœ°çƒå¤§æ°”å±‚å®¹æ˜“æ¶ˆå¤±"], a: 1, explanation: "â€œå¯çˆ±â€æŒ‡åœ°çƒå­•è‚²ç”Ÿå‘½ã€æ‹¥æœ‰ç¾ä¸½é£å…‰ï¼Œâ€œå®¹æ˜“ç ´ç¢â€æŒ‡åœ°çƒçš„ç”Ÿæ€ç¯å¢ƒæ˜“å› äººç±»æ´»åŠ¨é­åˆ°ç ´åï¼Œä½“ç°ä½œè€…å¯¹åœ°çƒçš„çƒ­çˆ±ä¸æ‹…å¿§ã€‚"},
            {type: "choice", q: "<span class='question-tag'>14</span>ä½œè€…æ¨å¯¼â€œä¿æŠ¤åœ°çƒâ€ç»“è®ºçš„é€»è¾‘é¡ºåºæ˜¯ï¼ˆ ï¼‰", o: ["åœ°çƒèµ„æºæœ‰é™â†’åœ°çƒæ¸ºå°â†’æ— æ³•ç§»å±…â†’ä¿æŠ¤åœ°çƒ", "åœ°çƒæ¸ºå°â†’åœ°çƒèµ„æºæœ‰é™â†’æ— æ³•ç§»å±…â†’ä¿æŠ¤åœ°çƒ", "æ— æ³•ç§»å±…â†’åœ°çƒæ¸ºå°â†’åœ°çƒèµ„æºæœ‰é™â†’ä¿æŠ¤åœ°çƒ", "åœ°çƒèµ„æºæœ‰é™â†’æ— æ³•ç§»å±…â†’åœ°çƒæ¸ºå°â†’ä¿æŠ¤åœ°çƒ"], a: 1, explanation: "è¯¾æ–‡å…ˆå†™åœ°çƒåœ¨å®‡å®™ä¸­â€œæ¸ºå°â€ï¼Œå†è¯´æ˜åœ°çƒâ€œèµ„æºæœ‰é™â€ï¼Œæ¥ç€è®ºè¯äººç±»â€œæ— æ³•ç§»å±…å…¶ä»–æ˜Ÿçƒâ€ï¼Œæœ€åå¾—å‡ºâ€œä¿æŠ¤åœ°çƒâ€çš„ç»“è®ºã€‚"},
            {type: "choice", q: "<span class='question-tag'>15</span>ä½œè€…å†™â€œåœ°çƒæ‰€æ‹¥æœ‰çš„è‡ªç„¶èµ„æºä¹Ÿæ˜¯æœ‰é™çš„â€æ—¶ï¼Œä¸»è¦æƒ³è¡¨è¾¾çš„æƒ…æ„Ÿæ˜¯ï¼ˆ ï¼‰", o: ["å¯¹è‡ªç„¶èµ„æºä¸°å¯Œçš„è‡ªè±ª", "å¯¹èµ„æºæœ‰é™çš„æ‹…å¿§", "å¯¹äººç±»æ™ºæ…§çš„ä¿¡å¿ƒ", "å¯¹å®‡å®™å¹¿é˜”çš„èµå¹"], a: 1, explanation: "ä½œè€…å¼ºè°ƒâ€œèµ„æºæœ‰é™â€ï¼Œæ˜¯ä¸ºäº†æé†’äººç±»çæƒœèµ„æºã€é¿å…ç ´åï¼Œæ ¸å¿ƒæƒ…æ„Ÿæ˜¯â€œå¯¹èµ„æºæœ‰é™çš„æ‹…å¿§â€ï¼›å…¶ä»–é€‰é¡¹ä¸æ®µè½ä¸»æ—¨ä¸ç¬¦ã€‚"},
            {type: "matching", q: "<span class='question-tag'>16</span>å°†è¯´æ˜æ–¹æ³•ä¸å¯¹åº”çš„ä¾‹å­åŠä½œç”¨é…å¯¹", left: ["ä¸¾ä¾‹å­", "åˆ—æ•°å­—", "æ‰“æ¯”æ–¹", "ä½œæ¯”è¾ƒ"], right: ["åœ°çƒæ˜¯ä¸€ä¸ªåŠå¾„çº¦ä¸º6400åƒç±³çš„æ˜Ÿçƒâ†’å‡†ç¡®è¯´æ˜åœ°çƒå¤§å°", "æ‹¿çŸ¿äº§èµ„æºæ¥è¯´...â†’å…·ä½“è¯´æ˜èµ„æºå½¢æˆä¸æ˜“", "åœ°çƒåƒç”Ÿå‘½çš„æ‘‡ç¯®â†’ç”ŸåŠ¨çªå‡ºåœ°çƒå­•è‚²ç”Ÿå‘½çš„ä½œç”¨", "åœ°çƒåœ¨å®‡å®™ä¸­...â†’çªå‡ºåœ°çƒçš„æ¸ºå°"], a: [1, 0, 2, 3], explanation: "ä¸¾ä¾‹å­éœ€ç»“åˆå…·ä½“äº‹ä¾‹ï¼Œåˆ—æ•°å­—éœ€å«å…·ä½“æ•°æ®ï¼Œæ‰“æ¯”æ–¹éœ€ç”¨æ¯”å–»ï¼Œä½œæ¯”è¾ƒéœ€çªå‡ºå¯¹æ¯”ã€‚"}
          ]
        },
        {
          title: "æ‹“å±•åº”ç”¨",
          questions: [
            {type: "choice", q: "<span class='question-tag'>17</span>ä¸‹åˆ—åšæ³•ä¸­ï¼Œä¸ç¬¦åˆâ€œä¿æŠ¤åœ°çƒâ€ç†å¿µçš„æ˜¯ï¼ˆ ï¼‰", o: ["å°†åƒåœ¾åˆ†ç±»æŠ•æ”¾...", "å¤–å‡ºè´­ç‰©è‡ªå¸¦å¸ƒè¢‹...", "ä¸ºæ–¹ä¾¿ï¼Œå¤§é‡ä½¿ç”¨ä¸€æ¬¡æ€§ç­·å­å’Œé¤ç›’", "éšæ‰‹å…³é—­æ°´é¾™å¤´å’Œç”µç¯..."], a: 2, explanation: "å¤§é‡ä½¿ç”¨ä¸€æ¬¡æ€§ç­·å­ï¼ˆæ¶ˆè€—æ£®æ—èµ„æºï¼‰å’Œé¤ç›’ï¼ˆé€ æˆç™½è‰²æ±¡æŸ“ï¼‰ä¼šç ´åç¯å¢ƒï¼Œä¸ç¬¦åˆä¿æŠ¤åœ°çƒç†å¿µï¼›å…¶ä»–é€‰é¡¹å‡ä¸ºç¯ä¿è¡Œä¸ºã€‚"},
            {type: "choice", q: "<span class='question-tag'>18</span>ä¸‹åˆ—å®£ä¼ è¯­ä¸­ï¼Œæœ€èƒ½ä½“ç°è¯¾æ–‡ä¸»æ—¨çš„æ˜¯ï¼ˆ ï¼‰", o: ["æ¢ç´¢å®‡å®™...", "çæƒœè‡ªç„¶èµ„æº...", "å‘å±•å·¥ä¸š...", "äº«å—ç”Ÿæ´»..."], a: 1, explanation: "è¯¾æ–‡ä¸»æ—¨æ˜¯â€œä¿æŠ¤åœ°çƒã€çæƒœèµ„æºâ€ï¼Œâ€œçæƒœè‡ªç„¶èµ„æºï¼Œå…±è¥ç”Ÿå‘½ç»¿è‰²â€ç›´æ¥å‘¼åº”è¿™ä¸€ä¸»é¢˜ï¼›Aé¡¹ä¸â€œæ— æ³•ç§»å±…â€çŸ›ç›¾ï¼ŒCã€Dé¡¹è¿èƒŒç¯ä¿ç†å¿µã€‚"},
            {type: "choice", q: "<span class='question-tag'>19</span>ä¸‹åˆ—å±äºâ€œä½ç¢³ç”Ÿæ´»â€çš„åšæ³•æ˜¯ï¼ˆ ï¼‰", o: ["ç»å¸¸å¼€è½¦å‡ºè¡Œ...", "é•¿æ—¶é—´å¼€ç©ºè°ƒ...", "ä¼˜å…ˆé€‰æ‹©å…¬äº¤ã€è‡ªè¡Œè½¦ç­‰ç»¿è‰²å‡ºè¡Œæ–¹å¼", "é¢‘ç¹ä½¿ç”¨æ‰“å°æœº..."], a: 2, explanation: "ä½ç¢³ç”Ÿæ´»æŒ‡å‡å°‘äºŒæ°§åŒ–ç¢³æ’æ”¾çš„ç”Ÿæ´»æ–¹å¼ï¼Œç»¿è‰²å‡ºè¡Œèƒ½å‡å°‘æ±½è½¦å°¾æ°”æ’æ”¾ï¼Œå±äºä½ç¢³è¡Œä¸ºï¼›å…¶ä»–é€‰é¡¹å‡ä¼šå¢åŠ èƒ½æºæ¶ˆè€—ã€‚"},
            {type: "choice", q: "<span class='question-tag'>20</span>ä¸‹åˆ—å±äºäººç±»ç ´ååœ°çƒå¯¼è‡´çš„ç”Ÿæ€ç¾éš¾çš„æ˜¯ï¼ˆ ï¼‰", o: ["åœ°éœ‡", "æµ·å•¸", "æ°´åœŸæµå¤±", "ç«å±±å–·å‘"], a: 2, explanation: "æ°´åœŸæµå¤±å¤šå› äººç±»ä¹±ç æ»¥ä¼ã€ç ´åæ¤è¢«å¯¼è‡´ï¼Œå±äºäººä¸ºç”Ÿæ€ç¾éš¾ï¼›åœ°éœ‡ã€æµ·å•¸ã€ç«å±±å–·å‘æ˜¯è‡ªç„¶ç°è±¡ã€‚"},
            {type: "choice", q: "<span class='question-tag'>21</span>ä¸ºâ€œä¿æŠ¤åœ°çƒâ€å†™å€¡è®®ä¹¦ï¼Œä¸‹åˆ—å†…å®¹ä¸é€‚åˆåˆ—å…¥çš„æ˜¯ï¼ˆ ï¼‰", o: ["æ‹’ç»é£Ÿç”¨é‡ç”ŸåŠ¨ç‰©...", "ç§¯æå‚ä¸æ¤æ ‘é€ æ—...", "å¤§é‡è´­ä¹°æ–°è¡£æœ...", "å®£ä¼ ç¯ä¿çŸ¥è¯†..."], a: 2, explanation: "å¤§é‡è´­ä¹°æ–°è¡£æœä¼šå¢åŠ èµ„æºæ¶ˆè€—å’Œå·¥ä¸šæ±¡æŸ“ï¼Œä¸ç¬¦åˆä¿æŠ¤åœ°çƒç†å¿µï¼›å…¶ä»–é€‰é¡¹å‡ä¸ºç§¯æçš„ç¯ä¿è¡ŒåŠ¨ã€‚"},
            {type: "choice", q: "<span class='question-tag'>22</span>ä»¿ç…§è¯¾æ–‡â€œæ‰“æ¯”æ–¹â€çš„è¯´æ˜æ–¹æ³•ï¼Œä¸‹åˆ—å¥å­ä¸­å†™æ³•æ­£ç¡®çš„æ˜¯ï¼ˆ ï¼‰", o: ["æ£®æ—åƒåœ°çƒçš„â€œè‚ºâ€ï¼Œä¸ºæˆ‘ä»¬å‡€åŒ–ç©ºæ°”", "æ£®æ—é¢ç§¯çº¦å åœ°çƒé™†åœ°é¢ç§¯çš„31%", "æ£®æ—æ¯”è‰åŸçš„ç©ºæ°”æ›´æ¸…æ–°", "æ£®æ—é‡Œç”Ÿæ´»ç€å„ç§å„æ ·çš„åŠ¨ç‰©"], a: 0, explanation: "Aé¡¹å°†æ£®æ—æ¯”ä½œâ€œåœ°çƒçš„è‚ºâ€ï¼Œè¿ç”¨äº†æ‰“æ¯”æ–¹çš„è¯´æ˜æ–¹æ³•ï¼Œä¸è¯¾æ–‡å†™æ³•ä¸€è‡´ï¼›Bé¡¹æ˜¯åˆ—æ•°å­—ï¼ŒCé¡¹æ˜¯ä½œæ¯”è¾ƒï¼ŒDé¡¹æ˜¯é™ˆè¿°å¥ã€‚"}
          ]
        }
      ]
    };

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
    function initEventListeners() {
      // ä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.uploadBtn.addEventListener('click', () => {
        // åˆ›å»ºæ–°çš„file inputé¿å…ç¼“å­˜é—®é¢˜
        const newInput = document.createElement('input');
        newInput.type = 'file';
        newInput.id = 'excel-upload';
        newInput.accept = '.xlsx, .xls';
        newInput.className = 'hidden';
        el.fileInputContainer.innerHTML = '';
        el.fileInputContainer.appendChild(newInput);
        
        newInput.addEventListener('change', handleFileUpload);
        newInput.click();
      });

      // é‡æ–°ä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.reuploadBtn.addEventListener('click', () => {
        el.uploadBtn.click();
      });

      // å­¦ç”Ÿå§“åé€‰æ‹©å˜åŒ–äº‹ä»¶
      el.studentName.addEventListener('change', () => {
        const selectedName = el.studentName.value;
        if (selectedName) {
          state.studentName = selectedName;
          el.enterGame.classList.remove('hidden');
        } else {
          el.enterGame.classList.add('hidden');
        }
      });

      // è¿›å…¥æ¸¸æˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.enterGame.addEventListener('click', () => {
        el.nameSelectPage.classList.add('hidden');
        el.intro.classList.remove('hidden');
        el.currentStudent.textContent = state.studentName;
      });

      // å¼€å§‹ç»ƒä¹ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.start.addEventListener('click', () => {
        el.intro.classList.add('hidden');
        el.levels.classList.remove('hidden');
        loadLevel(0);
      });

      // å…³å¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
      document.querySelectorAll('.level-card').forEach(card => {
        card.addEventListener('click', () => {
          const level = parseInt(card.dataset.level);
          if (!card.classList.contains('opacity-50')) {
            loadLevel(level);
          }
        });
      });

      // ä¸Šä¸€é¢˜æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.prev.addEventListener('click', () => {
        if (state.question > 0) {
          state.question--;
          renderQuestion();
        }
      });

      // ä¸‹ä¸€é¢˜æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.next.addEventListener('click', () => {
        if (state.question < data.levels[state.level].questions.length - 1) {
          state.question++;
          renderQuestion();
        }
      });

      // æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.submit.addEventListener('click', handleSubmit);

      // å®Œæˆå…³å¡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.complete.addEventListener('click', completeLevel);

      // é‡æ–°å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.restart.addEventListener('click', restart);

      // å…³é—­å¥–åŠ±å¼¹çª—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.closeReward.addEventListener('click', () => {
        el.rewardModal.classList.add('hidden');
      });

      // ä¸‹è½½HTMLæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.downloadHtml.addEventListener('click', downloadHtmlFile);

      // å¯¼å‡ºåˆ†æ•°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      el.exportScore.addEventListener('click', exportScoreRecord);
    }

    // å¤„ç†Excelæ–‡ä»¶ä¸Šä¼ 
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      el.uploadLoading.classList.remove('hidden');
      el.uploadBtn.classList.add('hidden');
      el.reuploadBtn.classList.add('hidden');
      el.uploadTip.classList.add('hidden');

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);

          // æå–å§“ååˆ—è¡¨ï¼ˆå‡è®¾Excelä¸­å§“ååˆ—æ ‡é¢˜ä¸º"å§“å"ï¼‰
          state.nameList = jsonData.map(item => {
            // å°è¯•å¤šç§å¯èƒ½çš„åˆ—åï¼ˆè€ƒè™‘å¯èƒ½çš„ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰
            const nameKey = Object.keys(item).find(key => 
              key.trim() === 'å§“å' || key.trim() === 'åå­—'
            );
            return nameKey ? item[nameKey] : null;
          }).filter(name => name !== null && name !== '');

          // æ›´æ–°UI
          el.fileName.textContent = file.name;
          el.uploadLoading.classList.add('hidden');
          el.uploadTip.classList.remove('hidden');
          el.reuploadBtn.classList.remove('hidden');
          el.nameSelectGroup.classList.remove('hidden');

          // å¡«å……ä¸‹æ‹‰æ¡†
          el.studentName.innerHTML = '<option value="">-- è¯·é€‰æ‹©å§“å --</option>';
          state.nameList.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            el.studentName.appendChild(option);
          });
        } catch (error) {
          console.error('è§£æExcelå¤±è´¥:', error);
          alert('è§£ææ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¡®ä¿ä¸Šä¼ çš„æ˜¯æ­£ç¡®çš„å§“ååå•Excelæ–‡ä»¶');
          el.uploadLoading.classList.add('hidden');
          el.uploadBtn.classList.remove('hidden');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    // åŠ è½½å…³å¡
    function loadLevel(level) {
      state.level = level;
      state.question = 0;
      el.levels.classList.add('hidden');
      el.exercise.classList.remove('hidden');
      el.levelTitle.textContent = data.levels[level].title;
      el.exerciseStudent.textContent = state.studentName;
      renderQuestion();
    }

    // æ¸²æŸ“é¢˜ç›®
    function renderQuestion() {
      const levelData = data.levels[state.level];
      const questionData = levelData.questions[state.question];
      
      // æ›´æ–°é—®é¢˜è®¡æ•°
      el.questionCount.textContent = `${state.question + 1}/${levelData.questions.length}`;
      
      // æ›´æ–°è¿›åº¦æ¡
      const progress = ((state.question + 1) / levelData.questions.length) * 100;
      el.levelProgress.style.width = `${progress}%`;
      
      // æ¸²æŸ“é—®é¢˜å†…å®¹
      el.question.innerHTML = questionData.q;
      
      // æ¸…ç©ºé€‰é¡¹å®¹å™¨
      el.options.innerHTML = '';
      
      // éšè—åé¦ˆå’ŒæŒ‰é’®
      el.feedback.classList.add('hidden');
      el.submit.classList.remove('hidden');
      el.next.classList.add('hidden');
      el.complete.classList.add('hidden');
      
      // æ˜¾ç¤ºä¸Šä¸€é¢˜æŒ‰é’®ï¼ˆå¦‚æœä¸æ˜¯ç¬¬ä¸€é¢˜ï¼‰
      if (state.question > 0) {
        el.prev.classList.remove('hidden');
      } else {
        el.prev.classList.add('hidden');
      }
      
      // æ¸²æŸ“é€‰é¡¹ï¼ˆé€‰æ‹©é¢˜ï¼‰
      if (questionData.type === 'choice') {
        questionData.o.forEach((option, index) => {
          const optionEl = document.createElement('div');
          optionEl.className = `option ${state.userAnswers[state.level]?.[state.question] === index ? 'selected' : ''}`;
          optionEl.dataset.index = index;
          optionEl.innerHTML = option;
          optionEl.addEventListener('click', () => {
            // æ¸…é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.option').forEach(el => {
              el.classList.remove('selected');
            });
            // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­
            optionEl.classList.add('selected');
          });
          el.options.appendChild(optionEl);
        });
      }
      // æ¸²æŸ“åŒ¹é…é¢˜
      else if (questionData.type === 'matching') {
        const matchContainer = document.createElement('div');
        matchContainer.className = 'match-container';
        
        const matchRow = document.createElement('div');
        matchRow.className = 'match-row';
        
        // å·¦ä¾§é€‰é¡¹åˆ—
        const leftCol = document.createElement('div');
        leftCol.className = 'match-column';
        
        const leftLabel = document.createElement('div');
        leftLabel.className = 'match-label';
        leftLabel.textContent = 'å·¦ä¾§é¡¹';
        leftCol.appendChild(leftLabel);
        
        questionData.left.forEach((item, index) => {
          const matchItem = document.createElement('div');
          matchItem.className = 'match-item';
          matchItem.draggable = true;
          matchItem.dataset.index = index;
          matchItem.textContent = item;
          
          // æ‹–æ‹½äº‹ä»¶
          matchItem.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', index);
            setTimeout(() => matchItem.classList.add('dragging'), 0);
          });
          
          matchItem.addEventListener('dragend', () => {
            matchItem.classList.remove('dragging');
          });
          
          leftCol.appendChild(matchItem);
        });
        
        // å³ä¾§ç›®æ ‡åˆ—
        const rightCol = document.createElement('div');
        rightCol.className = 'match-column';
        
        const rightLabel = document.createElement('div');
        rightLabel.className = 'match-label';
        rightLabel.textContent = 'å³ä¾§é¡¹';
        rightCol.appendChild(rightLabel);
        
        questionData.right.forEach((item, index) => {
          const target = document.createElement('div');
          target.className = `match-target ${state.userAnswers[state.level]?.[state.question]?.includes(index) ? 'filled' : ''}`;
          target.dataset.target = index;
          target.textContent = item;
          
          // æ‹–æ”¾äº‹ä»¶
          target.addEventListener('dragover', (e) => {
            e.preventDefault();
          });
          
          target.addEventListener('drop', (e) => {
            e.preventDefault();
            const sourceIndex = e.dataTransfer.getData('text/plain');
            // å­˜å‚¨ç­”æ¡ˆ
            if (!state.userAnswers[state.level]) state.userAnswers[state.level] = {};
            if (!state.userAnswers[state.level][state.question]) {
              state.userAnswers[state.level][state.question] = [];
            }
            state.userAnswers[state.level][state.question][sourceIndex] = index;
            target.classList.add('filled');
          });
          
          rightCol.appendChild(target);
        });
        
        matchRow.appendChild(leftCol);
        matchRow.appendChild(rightCol);
        matchContainer.appendChild(matchRow);
        el.options.appendChild(matchContainer);
      }
    }

    // å¤„ç†ç­”æ¡ˆæäº¤
    function handleSubmit() {
      const levelData = data.levels[state.level];
      const questionData = levelData.questions[state.question];
      let userAnswer;
      let isCorrect = false;
      
      // è·å–ç”¨æˆ·ç­”æ¡ˆï¼ˆé€‰æ‹©é¢˜ï¼‰
      if (questionData.type === 'choice') {
        const selectedOption = document.querySelector('.option.selected');
        if (!selectedOption) {
          alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ');
          return;
        }
        userAnswer = parseInt(selectedOption.dataset.index);
        isCorrect = userAnswer === questionData.a;
      }
      // åŒ¹é…é¢˜
      else if (questionData.type === 'matching') {
        userAnswer = state.userAnswers[state.level]?.[state.question] || [];
        isCorrect = JSON.stringify(userAnswer) === JSON.stringify(questionData.a);
      }
      
      // æ›´æ–°åˆ†æ•°å’Œç”Ÿå‘½å€¼
      if (isCorrect) {
        state.score++;
        el.feedback.className = 'feedback correct';
        el.feedback.innerHTML = `æ­£ç¡®ï¼<br>${questionData.explanation}`;
      } else {
        if (state.health > 0) {
          state.health--;
        }
        el.feedback.className = 'feedback wrong';
        el.feedback.innerHTML = `ä¸æ­£ç¡®<br>æ­£ç¡®ç­”æ¡ˆï¼š${getCorrectAnswerText(questionData)}<br>${questionData.explanation}`;
      }
      
      // è®°å½•å¾—åˆ†
      state.scoreRecords.push({
        questionNo: parseInt(questionData.q.match(/<span class='question-tag'>(\d+)<\/span>/)[1]),
        questionContent: questionData.q.replace(/<[^>]+>/g, ''),
        isCorrect,
        score: isCorrect ? 1 : 0,
        time: new Date().toLocaleString()
      });
      
      // æ˜¾ç¤ºåé¦ˆ
      el.feedback.classList.remove('hidden');
      el.submit.classList.add('hidden');
      
      // æ˜¾ç¤ºä¸‹ä¸€é¢˜æˆ–å®ŒæˆæŒ‰é’®
      if (state.question < levelData.questions.length - 1) {
        el.next.classList.remove('hidden');
      } else {
        el.complete.classList.remove('hidden');
      }
    }

    // è·å–æ­£ç¡®ç­”æ¡ˆæ–‡æœ¬
    function getCorrectAnswerText(questionData) {
      if (questionData.type === 'choice') {
        return questionData.o[questionData.a];
      } else if (questionData.type === 'matching') {
        let result = [];
        questionData.a.forEach((targetIndex, sourceIndex) => {
          result.push(`${questionData.left[sourceIndex]} â†’ ${questionData.right[targetIndex]}`);
        });
        return result.join('<br>');
      }
      return '';
    }

    // å®Œæˆå…³å¡
    function completeLevel() {
      state.completed[state.level] = true;
      
      // è§£é”ä¸‹ä¸€å…³
      if (state.level < data.levels.length - 1) {
        const nextLevelCard = document.querySelector(`.level-card[data-level="${state.level + 1}"]`);
        if (nextLevelCard) {
          nextLevelCard.classList.remove('opacity-50');
        }
      }
      
      // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…³å¡éƒ½å·²å®Œæˆ
      const allCompleted = state.completed.every(completed => completed);
      
      if (allCompleted) {
        // æ˜¾ç¤ºå®Œæˆé¡µé¢
        el.exercise.classList.add('hidden');
        el.result.classList.remove('hidden');
        el.resultStudent.textContent = state.studentName;
        el.finalScore.textContent = state.score;
        el.finalHealth.textContent = state.health;
        
        // æ˜¾ç¤ºè¿”å›æŒ‰é’®
        document.getElementById('back-btn').style.display = 'block';
        
        // å¦‚æœç”Ÿå‘½å€¼æ»¡åˆ†ï¼Œæ˜¾ç¤ºå¥–åŠ±å¼¹çª—
        if (state.health === 10) {
          el.rewardModal.classList.remove('hidden');
        }
      } else {
        // è¿”å›å…³å¡é€‰æ‹©é¡µé¢
        el.exercise.classList.add('hidden');
        el.levels.classList.remove('hidden');
      }
    }
    
    // é‡æ–°å¼€å§‹
    function restart() {
      // é‡ç½®çŠ¶æ€
      state.level = 0;
      state.question = 0;
      state.score = 0;
      state.health = 10;
      state.completed = [false, false, false, false];
      state.userAnswers = {};
      state.scoreRecords = [];
      
      // é‡ç½®UI
      el.result.classList.add('hidden');
      document.querySelectorAll('.level-card').forEach((card, index) => {
        if (index === 0) {
          card.classList.remove('opacity-50');
        } else {
          card.classList.add('opacity-50');
        }
      });
      loadLevel(0);
      
      // éšè—è¿”å›æŒ‰é’®
      document.getElementById('back-btn').style.display = 'none';
    }

    // é‡æ–°å¼€å§‹
    function restart() {
      // é‡ç½®çŠ¶æ€
      state.level = 0;
      state.question = 0;
      state.score = 0;
      state.health = 10;
      state.completed = [false, false, false, false];
      state.userAnswers = {};
      state.scoreRecords = [];
      
      // é‡ç½®UI
      el.result.classList.add('hidden');
      document.querySelectorAll('.level-card').forEach((card, index) => {
        if (index === 0) {
          card.classList.remove('opacity-50');
        } else {
          card.classList.add('opacity-50');
        }
      });
      loadLevel(0);
    }

    // ä¸‹è½½HTMLæ–‡ä»¶
    function downloadHtmlFile() {
      const htmlContent = document.documentElement.outerHTML;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'åªæœ‰ä¸€ä¸ªåœ°çƒç»ƒä¹ é¢˜.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('æ–‡ä»¶å·²ä¸‹è½½ï¼Œè¯·ä¿å­˜åˆ°E:\\youxiç›®å½•');
    }

    // å¯¼å‡ºåˆ†æ•°è®°å½•
    function exportScoreRecord() {
      // å‡†å¤‡CSVå†…å®¹
      let csvContent = 'é¢˜ç›®ç¼–å·,é¢˜ç›®å†…å®¹,æ˜¯å¦æ­£ç¡®,å¾—åˆ†,ç­”é¢˜æ—¶é—´\n';
      
      state.scoreRecords.forEach(record => {
        csvContent += `${record.questionNo},`;
        csvContent += `"${record.questionContent.replace(/"/g, '""')}",`;
        csvContent += `${record.isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯'},`;
        csvContent += `${record.score},`;
        csvContent += `${record.time}\n`;
      });
      
      // æ€»å¾—åˆ†è¡Œ
      csvContent += `,æ€»å¾—åˆ†,${state.score}/22,,,`;
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `${state.studentName}_åªæœ‰ä¸€ä¸ªåœ°çƒç»ƒä¹ é¢˜å¾—åˆ†è®°å½•.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('å¾—åˆ†è®°å½•å·²å¯¼å‡ºï¼Œè¯·ä¿å­˜åˆ°E:\\youxiç›®å½•');
    }

    // åˆå§‹åŒ–åº”ç”¨
    function init() {
      initEventListeners();
    }

    // å¯åŠ¨åº”ç”¨
    init();
  </script>
<!-- è¿”å›æŒ‰é’® -->
  <button id="back-btn" class="back-button">è¿”å›ä¸»ç•Œé¢</button>
  <script>
    // è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.getElementById('back-btn').addEventListener('click', function() {
        window.location.href = 'index.html';
    });
  </script>
</body>
</html>
